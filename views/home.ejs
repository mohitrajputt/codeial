<link rel="stylesheet" href="/css/home.css">
<script src="/js/home.js"></script>

<h1>Codeial / <%= title %></h1>

<div class="posts">
    <h1>Posts</h1>
    <% if(locals.user) { %>
    <form action="/posts/create" method="post">
        <textarea name="content" cols="30" rows="3" required></textarea>
        <input type="submit" value="Post">
    </form>
    <% } %>
</div>

<div class="show-posts" >
    <ul> 
        <% for ( i of post ) { %> 
            <li>
                <div class="delete" >
                    <% if (locals.user && locals.user.id == i.user.id)   { %>
                    <a href="/posts/delete/<%= i.id %>">X</a>
                    <% } %>
                </div>
                <h4 class="user-content" ><%= i.content %></h4>
                <h6 class="user" >Posted by <%= i.user.username %></h6>
                <div class="post-comment">
                    <% if(locals.user) { %>
                        <form action="/comments/create" method="post" >
                            <input type="text" name="content" placeholder="Type here to add comment" required>
                            <input type="hidden" name="post" value="<%= i._id %>">
                            <input type="submit" value="ADD Comment">
                        </form>
                    <% } %>
                </div>
                <div class="show-comments">
                    <ul>
                        <% for ( j of i.comments) { %>
                            <li id="comment" >
                                <% if (locals.user &&  (j.user.id == locals.user.id || j.user.id == j.post.id )) { %>
                                <a href="/comments/delete/<%= j.id %>">X</a>
                                <% } %>
                                <p class="comment-content" > <%= j.content %> <small class="comment-author" >Commented by <%= j.user.username %></small> </p>
                                <% } %>
                            </li>
                    </ul>
                </div>
            </li>
        <%}%>
    </ul>
</div>